---
title: Как донастроить сервер {{ baremetal-full-name }}
description: Следуя данной инструкции, вы сможете донастроить аппаратную часть сервера {{ baremetal-full-name }} под использование с определенной операционной системой и выполнение конкретных задач.
---

# Дополнительные настройки серверов

{% include [bios-settings-warning](../../_includes/baremetal/bios-settings-warning.md) %}

Для реализации некоторых сценариев работы сервера может потребоваться изменить базовые настройки сервера, заданные по умолчанию. Например, чтобы [установить](../operations/servers/reinstall-os-from-own-image.md) операционную систему [Windows Server](https://ru.wikipedia.org/wiki/Windows_Server) в раздел, созданный в отказоустойчивом [RAID-массиве](https://ru.wikipedia.org/wiki/RAID), можно [создать](#creating-rst-raids) нужный RAID-массив на встроенном контроллере материнской платы сервера (если материнская плата сервера содержит встроенный RAID-контроллер).

## Управление дисковым пространством серверов {#storage-management}

При аренде сервера с [установкой](../operations/servers/reinstall-os-from-marketplace.md) операционной системы из образа {{ marketplace-short-name }} на дисках сервера в зависимости от его конфигурации по умолчанию создается один или несколько [программных RAID-массивов](https://ru.wikipedia.org/wiki/RAID#Программный_RAID) уровня [RAID1](https://ru.wikipedia.org/wiki/RAID#RAID_1) и/или [RAID10](https://ru.wikipedia.org/wiki/RAID#RAID_10_(RAID_1+0)). Количество создаваемых по умолчанию массивов зависит от числа разных типов дисков, используемых на сервере.

В форме аренды сервера с операционной системой нажмите кнопку **{{ ui-key.yacloud.baremetal.action_disk-layout-settings }}**, чтобы перенастроить RAID-массивы, создаваемые по умолчанию, по-иному разбить дисковое пространство на программные RAID-массивы или совсем отказаться от их использования.

{% note alert %}

Использование RAID-массивов позволяет обеспечить отказоустойчивость: при выходе из строя одного или нескольких (в зависимости от используемого уровня RAID-массива) дисковых устройств данные могут быть сохранены. Исключение — RAID-массивы уровня [RAID0](https://ru.wikipedia.org/wiki/RAID#RAID_0), которые не обеспечивают отказоустойчивости.

{% endnote %}

### Управление дисковым пространством при установке ОС из своего образа {#manual-storage-management}

При аренде сервера без операционной системы диски сервера не организованы в RAID-массивы.

Устанавливая операционную систему из собственного образа, вы можете самостоятельно организовывать пространство установленных на сервере дисков:
* При установке ОС создать программные RAID-массивы, если эта технология поддерживается на уровне [ядра](https://ru.wikipedia.org/wiki/Ядро_операционной_системы) операционной системы (например, в ОС семейства [Linux](https://ru.wikipedia.org/wiki/Linux)).

    Некоторые операционные системы и программные продукты при установке не позволяют создавать программные RAID-массивы (например, [Microsoft Windows](https://ru.wikipedia.org/wiki/Windows) или VMware [ESXi](https://ru.wikipedia.org/wiki/VMware_ESXi)).

    Набор поддерживаемых уровней программных RAID-массивов может зависеть от конкретной устанавливаемой операционной системы.
* Перед установкой ОС [создать](#creating-rst-raids) логические RAID-массивы, если материнская плата вашего сервера содержит встроенные RAID-контроллеры ([RST](https://ru.wikipedia.org/wiki/RAID#Matrix) или `Fake-RAID`). Чтобы операционная система могла использовать такие RAID-массивы, может потребоваться предварительная установка драйвера для встроенного RAID-контроллера.

    Некоторые операционные системы и программные продукты не позволяют использовать RAID-массивы, созданные на Fake-RAID-контроллерах (например, VMware [ESXi](https://ru.wikipedia.org/wiki/VMware_ESXi)).
* Отказаться от использования технологии RAID и создавать [разделы](https://ru.wikipedia.org/wiki/Раздел_диска) непосредственно на дисках [HDD](https://ru.wikipedia.org/wiki/Жёсткий_диск), [SSD](https://ru.wikipedia.org/wiki/Твердотельный_накопитель) или [NVMe](https://ru.wikipedia.org/wiki/NVM_Express).

    Этот вариант не подразумевает возможности обеспечить отказоустойчивость дисковой системы: при выходе диска из строя данные на этом диске будут утеряны.

### Особенности RAID-массивов, создаваемых на встроенных RAID-контроллерах {#rst-raids}

В зависимости от модели материнской платы сервера {{ baremetal-name }}, она может быть оснащена одним или двумя встроенными RAID-контроллерами, или не иметь таких контроллеров.

Встроенные RAID-контроллеры на материнских платах серверов могут быть следующих типов:
* SATA (Serial AT Attachment) — поддерживает только интерфейс [SATA](https://ru.wikipedia.org/wiki/SATA);
* SCU (Storage Controller Unit) — поддерживает интерфейсы SATA и [SAS](https://ru.wikipedia.org/wiki/Serial_Attached_SCSI).

Встроенные RAID-контроллеры реализованы на уровне микропрограммы материнской платы, которая эмулирует блочное устройство с базовыми функциями для загрузчика, а для полноценной работы на уровне операционной системы требует установки драйвера.

{% note warning %}

При установке в RAID-массив, созданный на встроенном RAID-контроллере сервера, операционной системы Linux в Legacy-режиме может оказаться невозможным выбрать загрузочный диск для запуска ОС. Чтобы решить эту проблему, оставьте один физический диск невключенным в RAID-массивы либо [установите](#install-os-uefi) ОС в режиме UEFI.

{% endnote %}

#### Поддерживаемые уровни RAID-массивов {#supported-raid-levels}

Встроенные RAID-контроллеры позволяют создавать RAID-массивы следующих уровней:

* [RAID0](https://ru.wikipedia.org/wiki/RAID#RAID_0) — чередование. Массив может состоять из 2-6 дисков. Использование RAID-массива этого типа повышает скорость чтения и записи данных, но при этом снижает отказоустойчивость: данные будут потеряны при выходе из строя любого из дисков массива.
* [RAID1](https://ru.wikipedia.org/wiki/RAID#RAID_1) — зеркалирование. Массив может состоять из двух дисков. Использование RAID-массива этого типа не дает прироста в скорости чтения или записи, но повышает отказоустойчивость: при выходе из строя одного из дисков данные не будут потеряны.
* [RAID5](https://ru.wikipedia.org/wiki/RAID#RAID_5) — чередование с распределенной четностью. Может состоять из 3-6 дисков. Использование RAID-массива этого типа дает прирост в скорости чтения и повышает отказоустойчивость: при выходе из строя одного из дисков данные не будут потеряны.

    {% note info %}

    RAID-контроллер SCU на некоторых моделях материнских плат не поддерживает создание массивов уровня RAID5.

    {% endnote %}

* [RAID10](https://ru.wikipedia.org/wiki/RAID#RAID_10_(RAID_1+0)) — чередование массивов `RAID1`. Может состоять из 4-12 дисков, при этом число дисков в массиве всегда четное. Использование RAID-массива этого типа дает прирост в скорости чтения и записи данных, а также повышает отказоустойчивость: потеря данных произойдет только при выходе из строя обоих дисков в любом из массивов уровня `RAID1`, входящих в массив `RAID10`.

#### Ограничения при создании RAID-массивов {#raid-array-limitations}

С помощью встроенных RAID-контроллеров вы можете создавать RAID-массивы с учетом следующих ограничений:

* На одной группе дисков вы можете создать не более двух RAID-массивов.
* Указать размер вы можете только для RAID-массива, создаваемого на группе дисков _первым_.

    RAID-массив, создаваемый на этой группе дисков _вторым_, использует все нераспределенное дисковое пространство, оставшееся после создания первого RAID-массива.
* RAID-массив, создаваемый с использованием определенного диска _вторым_, должен быть создан ровно на тех же дисках, что и первый. 

    Например, если первый массив уровня `RAID0` создан на трех дисках `A`, `B` и `C`, то вторым массивом с использованием этих дисков может быть либо массив уровня `RAID5`, либо еще один массив уровня `RAID0` (так как только эти два уровня позволяют использовать по три диска). При этом будет невозможно создать второй массив на двух дисках (например, `A` и `B`), на трех дисках (например, `C`, `D` и `F`) или на четырех дисках (например, `A`, `B`, `C` и `D`), поскольку второй массив должен быть создан ровно на тех же трех дисках, что и первый: `A`, `B` и `C`. В то же время создать еще один массив на дисках `E` и `F` будет можно.

### Создание RAID-массивов на встроенном RAID-контроллере {#creating-rst-raids}

{% include [motherboard-specific-bios-warn](../../_includes/baremetal/motherboard-specific-bios-warn.md) %}

В зависимости от [режима](#boot-mode), в котором запускается ваш сервер, создание RAID-массивов на встроенных RAID-контроллерах выполняется по-разному. Чтобы создать RAID-массив:

1. Включите режим RAID на дисковых контроллерах:

    1. В [KVM-консоли](../operations/servers/server-kvm.md) войдите в меню системных настроек BIOS/UEFI. Для этого в процессе запуска сервера на экране [POST](https://ru.wikipedia.org/wiki/POST_(аппаратное_обеспечение)) нажмите клавишу **F11** или **Del**. На экране появится сообщение `Entering Setup...`.
    1. Дождитесь, когда откроется системное меню настроек, и с помощью клавиш **←** и **→** перейдите в раздел **Advanced**.

        1. Выберите раздел **SATA Configuration** и нажмите **Enter**.
        1. В открывшемся разделе выберите опцию **SATA Mode**, нажмите **Enter** и выберите значение **RAID Mode**.
        1. Нажмите клавишу **Esc**, чтобы вернуться в предыдущий раздел меню.
        1. Выберите раздел **SCU Configuration** и нажмите **Enter**.
        1. В открывшемся разделе выберите опцию **SCU RAID Option ROM/UEFI Driver**, нажмите **Enter** и выберите значение **Enabled**.
        1. Нажмите клавишу **Esc**, чтобы вернуться в предыдущий раздел меню.
    1. С помощью клавиш **←** и **→** перейдите в раздел **Save & Exit**, выберите пункт **Save Changes and Reset** и нажмите **Enter**.
    1. Подтвердите действие, нажав **Yes**, чтобы перезапустить сервер.
1. Настройте RAID-массивы:

    {% list tabs %}

    - Legacy-режим

      1. Откройте утилиту конфигурирования RAID-массивов. Для этого в процессе запуска сервера на экране [POST](https://ru.wikipedia.org/wiki/POST_(аппаратное_обеспечение)) при появлении списка подключенных к серверу физических дисков нажмите сочетание клавиш **Ctrl** + **I**.

          Если диски подключены одновременно к обоим RAID-контроллерам сервера (SATA и SCU), таблицы со списками дисков отобразятся дважды: в одном случае заголовок таблицы будет содержать строку `SATA Option ROM`, в другом — `SCU Option ROM`. Заходить в меню настроек каждого из этих двух контроллеров нужно по отдельности.
      1. Чтобы создать RAID-массив, выберите пункт меню **1. Create RAID Volume** и нажмите **Enter**. В открывшемся окне:

          1. Настройте параметры создаваемого RAID-массива.

              Переключение между пунктами меню выполняется с помощью клавиши **Tab**, просмотр возможных вариантов значений — с помощью клавиш **↑** и **↓**, выбор значения — с помощью клавиши **Enter**.
          1. Выберите пункт **Create Volume** и нажмите **Enter**.
          1. Введите `Y`, чтобы подтвердить действие.
      1. Чтобы удалить RAID-массив, выберите пункт меню **2. Delete RAID Volume** и нажмите **Enter**. В открывшемся окне:

          1. Выберите RAID-массив, который требуется удалить, и нажмите клавишу **Del**.
          1. Введите `Y`, чтобы подтвердить действие.
          1. Нажмите клавишу **Esc**, чтобы вернуться в предыдущий раздел меню.
      1. Чтобы выйти из утилиты конфигурирования RAID-массивов, выберите пункт меню **4. Exit** и нажмите **Enter**.
      1. Введите `Y`, чтобы подтвердить действие.

    - UEFI-режим

      1. В процессе перезапуска вновь нажмите клавишу **F11** или **Del**, чтобы войти в системное меню настроек, и дождитесь, когда меню настроек откроется.
      1. С помощью клавиш **←** и **→** перейдите в раздел **Advanced**.
      1. Чтобы создать RAID-массивы из дисков, подключенных к RAID-контроллеру SCU, выберите раздел **Intel RSTe SCU Controller** и нажмите **Enter**.

          {% include [uefi-create-raid-arrays](../../_includes/baremetal/uefi-create-raid-arrays.md) %}

      1. Чтобы создать RAID-массивы из дисков, подключенных к RAID-контроллеру SATA, выберите раздел **Intel RSTe SATA Controller** и нажмите **Enter**.

          {% include [uefi-create-raid-arrays](../../_includes/baremetal/uefi-create-raid-arrays.md) %}

      1. С помощью клавиш **←** и **→** перейдите в раздел **Save & Exit**, выберите пункт **Save Changes and Reset** и нажмите **Enter**.
      1. Подтвердите действие, нажав **Yes**, чтобы перезапустить сервер.

    {% endlist %}

## Режим загрузки операционной системы {#boot-mode}

{% include [motherboard-specific-bios-warn](../../_includes/baremetal/motherboard-specific-bios-warn.md) %}

Материнские платы серверов {{ baremetal-name }} поддерживают Legacy- и UEFI-режимы загрузки операционной системы. Режим загрузки ОС сервера задается в системных настройках [BIOS](https://ru.wikipedia.org/wiki/BIOS)/[UEFI](https://ru.wikipedia.org/wiki/Extensible_Firmware_Interface) материнской платы.

При [установке](../operations/servers/reinstall-os-from-marketplace.md) из образа {{ marketplace-short-name }} операционная система сервера всегда устанавливается и загружается в Legacy-режиме.

### Установка операционной системы в режиме UEFI {#install-os-uefi}

Чтобы установить операционную систему в UEFI-режиме, [установите](../operations/servers/reinstall-os-from-own-image.md) ее из собственного образа. При установке запускайте сервер с CD-дисковода, в который смонтирован установочный образ операционной системы, в UEFI-режиме. Для этого в [KVM-консоли](../operations/servers/server-kvm.md):

1. В верхнем меню KVM-консоли выберите **Media** → **Virtual Media Wizard...** или нажмите на значок с изображением CD-диска. В открывшемся окне:

    1. В секции **CD/DVD Media1** нажмите кнопку **Browse** и в директории `user-iso` выберите [загруженный ранее](../operations/image-upload.md) ISO-образ операционной системы.
    1. Нажмите кнопку **Connect CD/DVD**.
    1. Убедитесь, что в секции **Status** для устройства **Virtual CD 1** значение поля **Connected To** изменилось на путь к выбранному ISO-образу, и нажмите кнопку **Close**.
1. В правом верхнем углу KVM-консоли нажмите кнопку **Reboot to cdrom**.
1. Войдите в меню системных настроек BIOS/UEFI. Для этого в процессе запуска сервера на экране [POST](https://ru.wikipedia.org/wiki/POST_(аппаратное_обеспечение)) нажмите клавишу **F11** или **Del**. На экране появится сообщение `Entering Setup...`.
1. Дождитесь, когда откроется системное меню настроек.
1. Если вы планируете устанавливать ОС в RAID-массивы, [созданные](#creating-rst-raids) на встроенном RAID-контроллере, с помощью клавиш **←** и **→** перейдите в раздел **Advanced**.

    1. Выберите раздел **PCIe/PCI/PnP Configuration** и нажмите **Enter**.
    1. В открывшемся разделе выберите опцию **Launch Storage OpROM policy**, нажмите **Enter** и выберите значение **UEFI only**.
    1. Нажмите клавишу **Esc**, чтобы вернуться в предыдущий раздел меню.
1. С помощью клавиш **←** и **→** перейдите в раздел **Save & Exit**.
1. Если на предыдущем шаге вы изменяли настройки, сохраните изменения. Для этого выберите опцию **Save Changes**, нажмите **Enter** и в открывшемся окне подтвердите действие.
1. В секции **Boot Override** выберите `UEFI: AMI Virtual CDROM0 1.00` и нажмите **Enter**.

    Если в секции **Boot Override** нет такого пункта, перейдите в раздел настроек **Boot** и в разделе **UEFI Boot Drive BBS Priorities** добавьте его.

Сервер еще раз перезапустится и будет загружен с виртуального CD-дисковода в режиме `UEFI`. В этом режиме операционная система, установленная из смонтированного в CD-дисководе образа, будет также установлена в режиме `UEFI`.

### Запуск операционной системы в режиме UEFI {#start-os-uefi}

Чтобы установленная в режиме UEFI операционная система успешно запускалась на сервере, в настройках BIOS/UEFI выберите корректное загрузочное устройство. Для этого в [KVM-консоли](../operations/servers/server-kvm.md):

1. При перезапуске сервера после завершения установки операционной системы повторно войдите в меню системных настроек BIOS/UEFI. Для этого в процессе запуска сервера на экране [POST](https://ru.wikipedia.org/wiki/POST_(аппаратное_обеспечение)) нажмите клавишу **F11** или **Del** и дождитесь, когда откроется системное меню настроек.
1. Если ОС установлена в RAID-массивы, [созданные](#creating-rst-raids) на встроенном RAID-контроллере, с помощью клавиш **←** и **→** перейдите в раздел **Advanced**.

    1. Выберите раздел **PCIe/PCI/PnP Configuration** и нажмите **Enter**.
    1. В открывшемся разделе убедитесь, что для опции **Launch Storage OpROM policy** установлено значение **UEFI only**.

        {% note info %}

        Если для опции **Launch Storage OpROM policy** задано другое значение, измените его на **UEFI only**, после чего сохраните изменения, перезапустите сервер и вновь войдите в меню настроек BIOS/UEFI, чтобы выбрать загрузочное устройство.

        {% endnote %}

    1. Нажмите клавишу **Esc**, чтобы вернуться в предыдущий раздел меню.
1. С помощью клавиш **←** и **→** перейдите в раздел **Boot**.

    1. Выберите раздел **UEFI Boot Drive BBS Priorities**, нажмите **Enter** и в открывшемся разделе:

        1. В поле **1st Device** нажмите **Enter** и в зависимости от установленной операционной системы выберите значение `UEFI OS`, `Ubuntu`, `Windows Boot Manager` и т.п.
        1. Нажмите клавишу **Esc**, чтобы вернуться в предыдущий раздел меню.
    1. В секции **Set Boot Priority** в поле **1st Boot Device** выберите то же значение, которое вы выбрали до этого в настройках **UEFI Boot Drive BBS Priorities**.
1. С помощью клавиш **←** и **→** перейдите в раздел **Save & Exit**, выберите пункт **Save Changes and Reset**, нажмите **Enter** и подтвердите действие, нажав **Yes**.

В результате операционная система сервера будет запускаться с выбранного загрузочного носителя в режиме UEFI.
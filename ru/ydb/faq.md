# Вопросы и ответы о {{ ydb-name }}

На этой странице собраны вопросы и ответы о работе {{ ydb-name }}. Вопросы и ответы о {{ ydb-short-name }} читайте в [документации]({{ ydb.docs }}/faq/).

## Базы данных {{ ydb-name }} в Serverless режиме {#serverless-ydb}

### Как вторичные и векторные индексы влияют на стоимость запроса? {#secondary-vector-price}

Операции с индексами оцениваются по тем же правилам, что и операции с таблицами. Они отражаются в статистике исполнения запроса и включаются в суммарные показатели, на основании которых рассчитывается стоимость в RequestUnits (RU). Подробнее читайте в [правилах тарификации бессерверного режима для {{ ydb-short-name }} API](pricing/ru-yql.md).

При чтении данных из таблицы с использованием индекса в статистике исполнения запроса будут отображаться число записей, прочитанных из индекса, и их объем.

#### Вторичные индексы {#secondary-indexes}

При добавлении новой строки в таблицу в каждый вторичный индекс, существующий на этой таблице, также будет добавлена запись, что отразится в статистике количества добавленных записей и объема записанных данных.

При изменении строки таблицы в статистику попадут операции удаления старой записи из индекса и добавления новой — для каждого вторичного индекса, в которые включены изменяемые поля.

При удалении строки таблицы в статистику попадет удаление записей из всех вторичных индексов этой таблицы.

#### Векторные индексы {#vector-indexes}

Для запроса по одному вектору к индексу типа [`vector_kmeans_tree`](https://ydb.tech/docs/ru/dev/vector-indexes?version=main#kmeans-tree-type) чтение происходит в несколько этапов:

1. **Навигация по дереву индекса.**  
   На каждом из `levels` уровней дерева из текущего набора кластеров выбирается по [`KMeansTreeSearchTopSize`](https://ydb.tech/docs/ru/yql/reference/syntax/select/vector_index?version=main#kmeanstreesearchtopsize) кластеров (каждый из которых содержит по `clusters` подкластеров).
   В результате общее число необходимых чтений на этом этапе составляет порядка ${KMeansTreeSearchTopSize} * {levels} * {clusters}$.

1. **Обработка финальных кандидатов.**  
   После спуска по дереву индекса на последнем уровне из выбранных кластеров обрабатываются все содержащиеся в них строки.
   Число чтений на этом этапе составляет порядка ${KMeansTreeSearchTopSize} * N / {clusters}^{levels}$ (при сбалансированном дереве, где `N` — общее число строк).
   Если не используется [покрывающий индекс](https://ydb.tech/docs/ru/concepts/secondary_indexes#covering), для каждой найденной через индекс кандидатной записи дополнительно читается строка из основной таблицы.

### Что означает ошибка "RESOURCE_EXHAUSTED"? {#resource-exhausted}

Ошибка говорит о том, что достигнут один из лимитов.

Проверьте пропускную способность в настройках кластера {{ ydb-short-name }} и при необходимости увеличьте ее. Если после повышения пропускной способности проблема не решена или превышена квота, обратитесь в [техническую поддержку]({{ link-console-support }}).

### Что означает ошибка "ThrottlingException"? {#throttling-exception}

Ошибка связана с превышением [квоты](concepts/limits.md#ydb-quotas) на потребление [RU (Request Units)](concepts/serverless-and-dedicated.md#capacity) в секунду.

Квоту для каждой базы можно поменять в ее настройках (см. [{#T}](operations/manage-databases.md#update-db-serverless)). В случае, если вам не хватает квоты на облако, обратитесь в [техническую поддержку]({{ link-console-support }}).

Чтобы обезопасить пользователей от незапланированного потребления большего количества Request Units, мы рекомендуем выставлять [ограничения на максимальное потребление](concepts/serverless-and-dedicated.md#capacity).

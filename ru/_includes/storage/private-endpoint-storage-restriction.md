Вы можете ограничить доступ в бакет на уровне сервиса, тогда доступ к бакету будет возможен только из сервисных подключений {{ vpc-short-name }}.

{% note warning %}

После включения данной опции доступ в бакет из публичной сети будет невозможен. В том числе при текущей реализации будет невозможен доступ в бакет с помощью [консоли управления]({{ link-console-main }}). См. также [Особенности копирования объектов на стороне сервера (Server Side Copy)](#server-side-copy).

{% endnote %}

Чтобы разрешить доступ в бакет только из сервисных подключений {{ vpc-short-name }} на уровне сервиса:

{% list tabs group=instructions %}

- CLI {#cli}

  {% include [include](../cli-install.md) %}
  
  {% include [default-catalogue](../default-catalogue.md) %}

  1. Создайте дополнительные [ресурсные записи](../../dns/concepts/resource-record.md) в DNS для переопределения публичного FQDN сервиса, к которому создается подключение. Для этого включите специальный параметр сервисного подключения {{ vpc-short-name }}:
  
      ```bash
      yc vpc private-endpoint update \
        --id <идентификатор_сервисного_подключения> \
        --private-dns-records-enabled
      ```

  1. Измените настройки бакета, указав параметры для включения доступа только из сервисных подключений {{ vpc-short-name }}:
  
      ```bash
      yc storage bucket update \
        --name <имя_бакета> \
        --enable-private-endpoints true \
        --private-endpoints <идентификатор_сервисного_подключения>
      ```

      Где:
      * `--name` — имя бакета.
      * `--enable-private-endpoints` — параметр для включения доступа к бакету только из сервисных подключений {{ vpc-short-name }}. Если параметр не указан, доступ к бакету будет возможен как из публичной сети, так и из сервисных подключений {{ vpc-short-name }}.
      * `--private-endpoints` — список идентификаторов сервисных подключений {{ vpc-short-name }}, доступ из которых будет разрешен. 

        {% note warning %}

        Если идентификаторы сервисных подключений {{ vpc-short-name }} не указаны, доступ к бакету будет невозможен отовсюду. Однако останется возможность [выключить](#disable) ограничения на доступ только из сервисных подключений {{ vpc-short-name }}.

        {% endnote %}

{% endlist %}

Чтобы восстановить доступ к бакету из публичной сети: {#disable}

{% list tabs group=instructions %}

- CLI {#cli}

  Измените настройки бакета:
  
  ```bash
  yc storage bucket update \
    --name <имя_бакета> \
    --enable-private-endpoints false
  ```

  Где:
  * `--name` — имя бакета.
  * `--enable-private-endpoints` — параметр для включения доступа к бакету только из сервисных подключений {{ vpc-short-name }}.

    {% note tip %}

    После того как ограничение на доступ только из сервисных подключений {{ vpc-short-name }} снято, список сервисных подключений, переданный ранее в параметре `--private-endpoints`, сохраняется в настройках бакета. При повторном ограничении доступа нет необходимости передавать список еще раз.

    {% endnote %}

{% endlist %}